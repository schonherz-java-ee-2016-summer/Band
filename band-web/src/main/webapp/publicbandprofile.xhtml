<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<ui:composition template="/templates/pageTemplate.xhtml">
    <ui:define name="title">Public band profile</ui:define>
    <ui:define name="body">
        <h:outputStylesheet name="css/band.css"/>
        <f:metadata>
            <f:viewParam id="id" name="id" value="#{bandBean.bandVo.id}" required="true"/>
            <f:viewAction action="#{publicBandProfileBean.onload}"/>
        </f:metadata>
        <p:panel styleClass="main" header="Band profile">
            <h:panelGrid columns="2" cellpadding="5">
                <h:outputText styleClass="input-label" value="Band name: "/>
                <h:outputText styleClass="input-label" value="#{bandBean.bandVo.name}"/>
                <h:outputText styleClass="input-label" value="Band genre:"/>
                <h:outputText styleClass="input-label" value="#{bandBean.bandVo.genre}"/>
                <h:outputText styleClass="input-label" value="Band description: "/>
                <h:outputText styleClass="input-label" value="#{bandBean.bandVo.description}"/>
            </h:panelGrid>

            <h:panelGrid columns="4" cellpadding="5">
                <p:dataList value="#{publicBandProfileBean.bandMatesMB.bandMateVos}" var="bandMate">
                    <f:facet name="header">
                        Band Mates
                    </f:facet>
                    #{bandMate.firstName} #{bandMate.lastName}, #{bandMate.instrument}, #{bandMate.email}
                </p:dataList>
            </h:panelGrid>

            <p:galleria styleClass="centered" value="#{bandBean.bandVo.bandsImages}" var="image" panelWidth="600"
                        panelHeight="400" showCaption="true" rendered="#{not bandBean.bandVo.bandsImages.isEmpty()}">
                <p:graphicImage value="#{imageStreamerBean.image}" alt="#{image.caption}" title=" " width="600"
                                height="400">
                    <f:param name="imageId" value="#{image.id}"/>
                </p:graphicImage>
            </p:galleria>

            <div class="centered-text">
                    <p:commandButton value="Add image" type="button" onclick="PF('add').show();"/>
                    <p:commandButton value="Edit or remove images" type="button" onclick="PF('editAndRemove').show();"
                    rendered="#{not bandBean.bandVo.bandsImages.isEmpty()}"/>
            </div>

            <p:dialog modal="true" header="Add new image" widgetVar="add">
                <h:form>
                    <p:wizard flowListener="#{bandImageUploadBean.onFlowProcess}">
                        <p:tab id="caption">
                            <p:panel header="Give caption to image">
                                <p:messages/>
                                <h:panelGrid columns="2" cellpadding="5">
                                    <h:outputText styleClass="input-label" value="Caption"/>
                                    <p:inputText id="name" value="#{bandImageBean.bandImageVo.caption}" required="true"
                                                 requiredMessage="Validation error: Caption is required." styleClass="centered-block centered-text"/>
                                </h:panelGrid>
                            </p:panel>
                        </p:tab>

                        <p:tab id="uploadImage">
                            <p:panel header="Upload the image">
                                <p:messages/>
                                <h:panelGrid>
                                    <p:fileUpload fileUploadListener="#{bandImageUploadBean.upload}" mode="advanced"
                                                  dragDropSupport="false"
                                                  sizeLimit="10000000" fileLimit="1"
                                                  allowTypes="/(\.|\/)(gif|jpe?g|png)$/"/>
                                </h:panelGrid>
                            </p:panel>
                        </p:tab>
                    </p:wizard>
                </h:form>
            </p:dialog>

            <p:dialog styleClass="editor" modal="true" header="Image editor" widgetVar="editAndRemove">
                <h:form>
                    <p:dataTable id="editorTable" styleClass="editor" value="#{editBandImageBean.bandImageVoWrapper.bandImageVoList}"
                                 var="image" rowStyleClass="centered-text">
                        <p:column headerText="Image" style="width: 80px">
                            <p:graphicImage value="#{imageStreamerBean.image}" width="60" height="40">
                                <f:param name="imageId" value="#{image.id}"/>
                            </p:graphicImage>
                        </p:column>
                        <p:column headerText="Name">
                            <h:outputText value="#{image.name}"/>
                        </p:column>
                        <p:column headerText="Caption">
                            <h:inputTextarea value="#{image.caption}" styleClass="centered-block sizetoeditor" required="true"
                                requiredMessage="Caption is required!"/>
                        </p:column>
                        <p:column headerText="Edit" styleClass="sizetoeditor">
                            <p:commandButton value="Edit" ajax="false"
                                             action="#{editBandImageBean.executeEdit(image.id)}"/>
                        </p:column>
                        <p:column headerText="Remove" styleClass="sizetoeditor">
                            <p:commandButton value="Remove" ajax="false"
                                             action="#{editBandImageBean.removeImage(image.id)}"/>
                        </p:column>
                    </p:dataTable>
                </h:form>
            </p:dialog>
        </p:panel>
    </ui:define>
</ui:composition>

</html>
